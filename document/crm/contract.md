# 合同管理模块需求文档

## 1. 功能概述

合同管理模块是 CRM 系统的核心业务模块，用于管理销售合同的全生命周期。该模块支持合同的创建、审批、执行、回款等环节的管理，并与客户、商机、产品等模块紧密关联。

## 2. 功能需求

### 2.1 基础功能

#### 2.1.1 合同创建
- 支持手动创建新合同
- 必填信息包括：
  - 合同名称
  - 所属客户
  - 合同金额
  - 负责人
  - 签约人
  - 签约联系人
- 可选信息包括：
  - 关联商机
  - 合同编号
  - 签约时间
  - 备注信息

#### 2.1.2 合同查询
- 支持分页查询合同列表
- 支持多条件筛选：
  - 合同名称
  - 所属客户
  - 负责人
  - 创建时间
  - 合同状态
  - 合同金额
- 支持导出 Excel
- 支持按客户查询合同
- 支持按商机查询合同

#### 2.1.3 合同详情
- 显示合同的完整信息
- 包含：
  - 基本信息
  - 所属客户信息
  - 负责人信息
  - 签约信息
  - 相关产品
  - 回款记录
  - 操作日志

#### 2.1.4 合同编辑
- 支持修改合同信息
- 记录修改历史
- 权限控制

#### 2.1.5 合同删除
- 支持删除合同
- 删除前进行确认
- 记录删除操作

### 2.2 高级功能

#### 2.2.1 合同审批
- 支持合同提交审批
- 支持合同审批流程
- 记录审批历史
- 支持审批通知

#### 2.2.2 合同分配
- 支持合同转移给其他负责人
- 记录转移历史
- 支持分配通知

#### 2.2.3 产品关联
- 支持合同关联产品
- 支持设置产品数量、单价
- 自动计算合同金额
- 记录产品变更历史

#### 2.2.4 回款管理
- 支持记录合同回款
- 自动计算已回款金额
- 支持回款计划
- 记录回款历史

#### 2.2.5 合同提醒
- 支持合同到期提醒
- 支持回款提醒
- 支持审批提醒
- 支持提醒配置

### 2.3 权限控制

- 创建权限：crm:contract:create
- 更新权限：crm:contract:update
- 删除权限：crm:contract:delete
- 查询权限：crm:contract:query
- 导出权限：crm:contract:export

## 3. 数据模型

### 3.1 合同信息（CrmContractDO）
- 基本信息
  - 合同ID
  - 合同名称
  - 客户ID
  - 商机ID
  - 合同金额
  - 合同编号
- 签约信息
  - 签约人ID
  - 签约联系人ID
  - 签约时间
- 负责人信息
  - 负责人ID
  - 负责人部门
- 时间信息
  - 创建时间
  - 更新时间
- 状态信息
  - 合同状态
  - 审批状态
- 其他信息
  - 备注

### 3.2 合同产品（CrmContractProductDO）
- 产品信息
  - 合同ID
  - 产品ID
  - 产品数量
  - 产品单价
  - 产品总价

### 3.3 合同配置（CrmContractConfigDO）
- 配置信息
  - 合同编号前缀
  - 合同编号规则
  - 提醒配置

## 4. 接口设计

### 4.1 合同管理接口
- POST /crm/contract/create - 创建合同
- PUT /crm/contract/update - 更新合同
- DELETE /crm/contract/delete - 删除合同
- GET /crm/contract/get - 获取合同详情
- GET /crm/contract/page - 获取合同分页列表
- GET /crm/contract/export-excel - 导出合同Excel
- GET /crm/contract/simple-list - 获取合同精简列表

### 4.2 合同查询接口
- GET /crm/contract/page-by-customer - 获取客户下的合同列表
- GET /crm/contract/page-by-business - 获取商机下的合同列表

### 4.3 合同审批接口
- PUT /crm/contract/submit - 提交合同审批

### 4.4 合同转移接口
- PUT /crm/contract/transfer - 合同转移

### 4.5 合同统计接口
- GET /crm/contract/audit-count - 获取待审核合同数量
- GET /crm/contract/remind-count - 获取即将到期合同数量

## 5. 注意事项

1. 合同必须关联客户
2. 合同审批流程需要符合业务规则
3. 所有操作需要记录操作日志
4. 导出数据需要考虑性能问题
5. 合同状态变更需要记录变更历史
6. 合同金额计算需要考虑精度问题
7. 合同转移需要考虑关联数据的处理
8. 回款记录需要与合同金额保持一致
9. 合同提醒需要支持自定义配置
10. 合同编号需要支持自定义规则 