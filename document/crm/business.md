# 商机管理模块需求文档

## 1. 功能概述

商机管理模块是 CRM 系统的核心业务模块，用于管理销售机会和商机跟进。该模块支持商机的创建、跟进、转化等全生命周期管理，并与客户、联系人、产品等模块紧密关联。

## 2. 功能需求

### 2.1 基础功能

#### 2.1.1 商机创建
- 支持手动创建新商机
- 必填信息包括：
  - 商机名称
  - 所属客户
  - 商机金额
  - 负责人
  - 商机状态
- 可选信息包括：
  - 商机来源
  - 预计成交时间
  - 备注信息

#### 2.1.2 商机查询
- 支持分页查询商机列表
- 支持多条件筛选：
  - 商机名称
  - 所属客户
  - 负责人
  - 创建时间
  - 商机状态
  - 商机金额
- 支持导出 Excel
- 支持按客户查询商机
- 支持按联系人查询商机

#### 2.1.3 商机详情
- 显示商机的完整信息
- 包含：
  - 基本信息
  - 所属客户信息
  - 负责人信息
  - 商机状态信息
  - 相关产品
  - 相关联系人
  - 操作日志

#### 2.1.4 商机编辑
- 支持修改商机信息
- 记录修改历史
- 权限控制

#### 2.1.5 商机删除
- 支持删除商机
- 删除前进行确认
- 记录删除操作

### 2.2 高级功能

#### 2.2.1 商机状态管理
- 支持自定义商机状态类型
- 支持自定义商机状态
- 支持商机状态流转
- 记录状态变更历史
- 支持设置状态结束标志

#### 2.2.2 商机分配
- 支持商机转移给其他负责人
- 记录转移历史
- 支持分配通知

#### 2.2.3 产品关联
- 支持商机关联产品
- 支持设置产品数量、单价
- 自动计算商机金额
- 记录产品变更历史

#### 2.2.4 联系人关联
- 支持商机关联联系人
- 支持设置主要联系人
- 记录联系人变更历史

### 2.3 权限控制

- 创建权限：crm:business:create
- 更新权限：crm:business:update
- 删除权限：crm:business:delete
- 查询权限：crm:business:query
- 导出权限：crm:business:export

## 3. 数据模型

### 3.1 商机信息（CrmBusinessDO）
- 基本信息
  - 商机ID
  - 商机名称
  - 客户ID
  - 商机金额
  - 状态类型ID
  - 状态ID
- 负责人信息
  - 负责人ID
  - 负责人部门
- 时间信息
  - 创建时间
  - 更新时间
  - 预计成交时间
- 状态信息
  - 是否结束
  - 商机来源
- 其他信息
  - 备注

### 3.2 商机状态类型（CrmBusinessStatusTypeDO）
- 状态类型信息
  - 状态类型ID
  - 状态类型名称
  - 排序

### 3.3 商机状态（CrmBusinessStatusDO）
- 状态信息
  - 状态ID
  - 状态类型ID
  - 状态名称
  - 是否结束
  - 排序

### 3.4 商机产品（CrmBusinessProductDO）
- 产品信息
  - 商机ID
  - 产品ID
  - 产品数量
  - 产品单价
  - 产品总价

## 4. 接口设计

### 4.1 商机管理接口
- POST /crm/business/create - 创建商机
- PUT /crm/business/update - 更新商机
- DELETE /crm/business/delete - 删除商机
- GET /crm/business/get - 获取商机详情
- GET /crm/business/page - 获取商机分页列表
- GET /crm/business/export-excel - 导出商机Excel
- GET /crm/business/simple-all-list - 获取商机精简列表

### 4.2 商机查询接口
- GET /crm/business/page-by-customer - 获取客户下的商机列表
- GET /crm/business/page-by-contact - 获取联系人下的商机列表

### 4.3 商机状态接口
- PUT /crm/business/update-status - 更新商机状态

### 4.4 商机转移接口
- PUT /crm/business/transfer - 商机转移

## 5. 注意事项

1. 商机必须关联客户
2. 商机状态流转需要符合业务规则
3. 所有操作需要记录操作日志
4. 导出数据需要考虑性能问题
5. 商机状态变更需要记录变更历史
6. 商机金额计算需要考虑精度问题
7. 商机转移需要考虑关联数据的处理
8. 商机状态类型和状态需要支持自定义配置 