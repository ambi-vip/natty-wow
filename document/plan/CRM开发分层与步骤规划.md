# CRM系统开发分层与步骤规划

## 一、分层结构说明

### 1. 通用UMS（账户、用户、权限等）
- 统一在 `platform.ums` 领域包下实现，包含：
  - 账户（Account）
  - 用户（User）
  - 角色（Role）
  - 权限（Permission）
  - 会话/认证（Session/Auth）
- 相关命令、事件、聚合、状态、Saga、API对象全部归于 UMS 分层。

### 2. CRM子模块（每个模块单独分层）
- 每个CRM核心模块单独分层，包结构建议如下：
  - 客户管理（customer）
  - 联系人管理（contact）
  - 销售机会（opportunity）
  - 跟进活动（activity）
  - 线索管理（lead）
  - 合同与订单（contract/order）
  - 报表与统计（report）
- 每个模块独立聚合、命令、事件、Saga、API对象，便于扩展和维护。

---

## 二、开发步骤总览（分阶段推进）

### 阶段一：通用UMS能力完善
1. 账户、用户、角色、权限、会话等聚合与API梳理
2. 认证、授权、权限校验、用户管理等基础能力完善
3. UMS相关聚合、Saga、事件补偿、测试

### 阶段二：客户管理模块（Customer）
1. 领域建模：客户聚合、命令、事件、状态、API对象
2. 客户增删改查、分组、标签等功能实现
3. 客户相关投影、查询接口、测试

### 阶段三：联系人管理模块（Contact）
1. 领域建模：联系人聚合、命令、事件、状态、API对象
2. 联系人与客户关联、增删改查
3. 联系人相关投影、查询接口、测试

### 阶段四：销售机会模块（Opportunity）
1. 领域建模：机会聚合、命令、事件、状态、API对象
2. 机会创建、分配、阶段流转、与客户/联系人关联
3. 机会相关投影、查询接口、测试

### 阶段五：活动/跟进模块（Activity）
1. 领域建模：活动聚合、命令、事件、状态、API对象
2. 活动与客户、机会关联，跟进记录
3. 活动相关投影、查询接口、测试

### 阶段六：线索管理模块（Lead）
1. 领域建模：线索聚合、命令、事件、状态、API对象
2. 线索录入、分配、转化为客户的Saga
3. 线索相关投影、查询接口、测试

### 阶段七：合同与订单模块（Contract/Order）
1. 领域建模：合同、订单聚合、命令、事件、状态、API对象
2. 合同审批、订单流转
3. 合同、订单相关投影、查询接口、测试

### 阶段八：报表与统计模块（Report）
1. 领域建模：报表聚合、命令、事件、状态、API对象
2. 多维度统计报表实现
3. 报表相关投影、查询接口、测试

### 阶段九：系统测试、补偿、监控
1. 聚合、Saga单元测试
2. 事件补偿、监控配置

### 阶段十：CI/CD与部署
1. 自动化测试、覆盖率、代码风格检查
2. Docker/K8S部署配置

---

## 三、后续执行说明
- 每进入一个新阶段，将在 `document/plan/` 下新建详细设计与任务分解文档。
- 每个阶段完成后，进行代码实现、测试、文档同步推进。
- 如需调整优先级或细化某模块，请随时提出。 